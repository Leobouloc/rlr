import unittest
import numpy
from rlr.lr import lr, phi

class DataModelTest(unittest.TestCase) :

    def test_zero_alpha(self) :
        labels = numpy.array([0, 1] * 6).reshape(12, )
        examples = numpy.array([1, 0] * 6).reshape(12, 1)

        weights, bias = lr(labels, examples, 0)
        scores = numpy.dot(examples, weights) + bias

        numpy.testing.assert_almost_equal(phi(scores),
                                          labels,
                                          3)

    def test_large_alpha(self) :
        labels = numpy.array([0, 1] * 6).reshape(12, )
        examples = numpy.array([1, 0] * 6).reshape(12, 1)

        weights, bias = lr(labels, examples, 100)
        scores = numpy.dot(examples, weights) + bias

        numpy.testing.assert_almost_equal(phi(scores),
                                          numpy.array([0.5]*12),
                                          3)


    def test_rounding_error(self) :
        examples = numpy.array(
            [[ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               0.5       ,  1.04166663,  5.2750001 ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.5       ,  1.61556602,  1.        ,  0.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               0.5       ,  0.5       ,  0.5       ,  1.70000005,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               1.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               4.78571415,  3.91745281,  1.        ,  0.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               0.5       ,  4.375     ,  4.35227251,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               5.5       ,  3.58712125,  0.        ,  1.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               4.25      ,  5.5       ,  4.60833311,  5.5       ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               1.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               5.5       ,  4.62812519,  0.        ,  2.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               0.5       ,  1.04166663,  0.5       ,  5.01785707,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               1.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               3.35714293,  2.79500008,  1.        ,  0.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               1.75      ,  1.04166663,  0.5       ,  1.70000005,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               1.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               5.5       ,  4.79391909,  1.        ,  0.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               0.5       ,  0.5       ,  0.5       ,  0.5       ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               1.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.5       ,  1.        ,  0.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               0.5       ,  0.95833331,  0.5       ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               4.07142878,  4.31931829,  1.        ,  0.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               4.25      ,  0.5       ,  0.5       ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               5.5       ,  4.94444466,  1.        ,  0.5       ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               4.07142878,  2.5       ,  0.5       ,  0.5       ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               1.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.5       ,  0.63793105,  0.        ,  0.        ],
             [ 1.        ,  0.        ,  1.        ,  0.        ,  0.        ,
               0.5       ,  0.5       ,  0.5       ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  1.        ,  1.        ,  1.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               0.        ,  0.        ,  0.        ,  0.        ,  0.        ,
               4.07142878,  2.38010216,  1.        ,  0.5       ]])

        labels = numpy.array([1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1])

        lr(labels, examples, 0.0001)
